<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>üêç –ó–º–µ–π–∫–∞</title>
    <style>
        :root {
            --bg-color: #0f0f13;
            --card-bg: #1f2023;
            --text-color: #ffffff;
            --accent-color: #006699; /* –¢–µ–º–Ω–µ–µ —Å–∏–Ω–∏–π */
            --secondary-text: #8a8e97;
            --border-radius: 16px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            --font-main: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        .header {
            background-color: var(--card-bg);
            padding: 16px;
            box-shadow: var(--shadow);
            position: absolute;
            top: 0;
            width: 100%;
            max-width: 600px;
            text-align: center;
            z-index: 100;
        }

        .header h1 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
            color: var(--accent-color);
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-top: 80px;
        }

        #game-board {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .score-container {
            display: flex;
            justify-content: space-between;
            width: 300px;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        .start-btn {
            padding: 12px 24px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
        }

        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            display: none;
        }

        .instructions {
            color: var(--secondary-text);
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üêç –ó–º–µ–π–∫–∞</h1>
    </div>

    <div class="game-container">
        <div class="score-container">
            <div>–°—á—ë—Ç: <span id="score">0</span></div>
            <div>–†–µ–∫–æ—Ä–¥: <span id="high-score">0</span></div>
        </div>

        <canvas id="game-board" width="300" height="300"></canvas>

        <button class="start-btn" id="start-btn">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å</button>
        <div class="instructions">–ù–∞ –ü–ö: WASD –∏–ª–∏ —Å—Ç—Ä–µ–ª–∫–∏. –ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ: —Å–≤–∞–π–ø—ã –ø–æ —ç–∫—Ä–∞–Ω—É.</div>
    </div>

    <div class="game-over" id="game-over">
        <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
        <p>–í–∞—à —Å—á—ë—Ç: <span id="final-score">0</span></p>
        <button class="start-btn" onclick="resetGame()">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>

    <script>
        const canvas = document.getElementById('game-board');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const highScoreDisplay = document.getElementById('high-score');
        const finalScoreDisplay = document.getElementById('final-score');
        const startBtn = document.getElementById('start-btn');
        const gameOverScreen = document.getElementById('game-over');

        const gridSize = 15;
        const tileCount = canvas.width / gridSize;

        let snake = [];
        let food = {};
        let dx = 0;
        let dy = 0;
        let score = 0;
        let highScore = localStorage.getItem('snakeHighScore') || 0;
        let gameRunning = false;
        let gameStarted = false;

        highScoreDisplay.textContent = highScore;

        function initGame() {
            // –°—Ç–∞—Ä—Ç–æ–≤–∞—è –∑–º–µ–π–∫–∞: 3 —Å–µ–≥–º–µ–Ω—Ç–∞, –∏–¥—É—â–∏–µ –≤–ø—Ä–∞–≤–æ
            snake = [
                {x: 10, y: 10}, // –ì–æ–ª–æ–≤–∞
                {x: 9, y: 10}, // –¢–µ–ª–æ
                {x: 8, y: 10}  // –•–≤–æ—Å—Ç
            ];
            dx = 1; // –ù–∞—á–∞–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –≤–ø—Ä–∞–≤–æ
            dy = 0;
            score = 0;
            scoreDisplay.textContent = score;
            generateFood();
        }

        function drawSnake() {
            ctx.fillStyle = '#4CAF50';
            snake.forEach(segment => {
                ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize - 1, gridSize - 1);
            });
        }

        function drawFood() {
            ctx.fillStyle = '#FF5722';
            ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize - 1, gridSize - 1);
        }

        function moveSnake() {
            if (dx === 0 && dy === 0) return;

            const head = {x: snake[0].x + dx, y: snake[0].y + dy};

            if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
                gameOver();
                return;
            }

            for (let i = 0; i < snake.length; i++) {
                if (snake[i].x === head.x && snake[i].y === head.y) {
                    gameOver();
                    return;
                }
            }

            snake.unshift(head);

            if (head.x === food.x && head.y === food.y) {
                score++;
                scoreDisplay.textContent = score;
                generateFood(); // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é –µ–¥—É
            } else {
                snake.pop(); // –£–±–∏—Ä–∞–µ–º —Ö–≤–æ—Å—Ç, –µ—Å–ª–∏ –Ω–µ —Å—ä–µ–ª–∏ –µ–¥—É
            }
        }

        function generateFood() {
            // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Å—Ç–∞—Ä–æ–π –µ–¥—ã (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
            const minDistance = 5;
            let newFood;
            let attempts = 0; // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
            const maxAttempts = 100;

            do {
                // –û—Ç—Å—Ç—É–ø –≤ 1 –∫–ª–µ—Ç–∫—É –æ—Ç –∫—Ä–∞—è: [1, tileCount - 2]
                newFood = {
                    x: Math.floor(Math.random() * (tileCount - 2)) + 1,
                    y: Math.floor(Math.random() * (tileCount - 2)) + 1
                };

                attempts++;

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Ä—è–¥–æ–º –ª–∏ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –µ–¥–æ–π (–µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞)
                let tooClose = false;
                if (food.x !== undefined && food.y !== undefined) {
                    const dx = newFood.x - food.x;
                    const dy = newFood.y - food.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance < minDistance) {
                        tooClose = true;
                    }
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –Ω–∞ –∑–º–µ–π–∫–µ –ª–∏ –Ω–æ–≤–∞—è –µ–¥–∞
                for (let segment of snake) {
                    if (segment.x === newFood.x && segment.y === newFood.y) {
                        tooClose = true;
                        break;
                    }
                }

                // –ï—Å–ª–∏ –Ω–µ —Ä—è–¥–æ–º –∏ –Ω–µ –Ω–∞ –∑–º–µ–π–∫–µ, –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫
                if (!tooClose || attempts >= maxAttempts) {
                    food = newFood;
                    break;
                }

            } while (attempts < maxAttempts);
        }

        function draw() {
            ctx.fillStyle = '#1f2023';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawSnake();
            drawFood();
        }

        function gameLoop() {
            if (!gameRunning) return;

            moveSnake();
            draw();

            setTimeout(gameLoop, 150);
        }

        function startGame() {
            if (gameStarted) {
                if (gameRunning) {
                    pauseGame();
                } else {
                    resumeGame();
                }
                return;
            }

            initGame();
            gameRunning = true;
            gameStarted = true;
            startBtn.textContent = '‚è∏Ô∏è –ü–∞—É–∑–∞';
            gameLoop();
        }

        function pauseGame() {
            gameRunning = false;
            startBtn.textContent = '‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
        }

        function resumeGame() {
            gameRunning = true;
            startBtn.textContent = '‚è∏Ô∏è –ü–∞—É–∑–∞';
            gameLoop();
        }

        function gameOver() {
            gameRunning = false;
            gameStarted = false;
            startBtn.textContent = '‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å';
            finalScoreDisplay.textContent = score;

            if (score > highScore) {
                highScore = score;
                localStorage.setItem('snakeHighScore', highScore);
                highScoreDisplay.textContent = highScore;
            }

            gameOverScreen.style.display = 'block';
        }

        function resetGame() {
            gameOverScreen.style.display = 'none';
        }

        function changeDirection(direction) {
            if (!gameRunning || (dx === 0 && dy === 0 && !gameStarted)) return;

            switch (direction) {
                case 'up':
                    if (dy !== 1) {
                        dx = 0;
                        dy = -1;
                    }
                    break;
                case 'down':
                    if (dy !== -1) {
                        dx = 0;
                        dy = 1;
                    }
                    break;
                case 'left':
                    if (dx !== 1) {
                        dx = -1;
                        dy = 0;
                    }
                    break;
                case 'right':
                    if (dx !== -1) {
                        dx = 1;
                        dy = 0;
                    }
                    break;
            }
        }

        document.addEventListener('keydown', e => {
            if (!gameStarted) return;

            switch (e.key.toLowerCase()) {
                case 'w':
                case '—Ü':
                case 'arrowup':
                    changeDirection('up');
                    break;
                case 's':
                case '—ã':
                case 'arrowdown':
                    changeDirection('down');
                    break;
                case 'a':
                case '—Ñ':
                case 'arrowleft':
                    changeDirection('left');
                    break;
                case 'd':
                case '–≤':
                case 'arrowright':
                    changeDirection('right');
                    break;
            }
        });

        let touchStartX = 0;
        let touchStartY = 0;

        canvas.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            e.preventDefault();
        });

        canvas.addEventListener('touchmove', e => {
            e.preventDefault();
        });

        canvas.addEventListener('touchend', e => {
            if (!gameStarted) return;

            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;

            const dx = touchEndX - touchStartX;
            const dy = touchEndY - touchStartY;

            if (Math.abs(dx) > Math.abs(dy)) {
                if (dx > 0) {
                    changeDirection('right');
                } else {
                    changeDirection('left');
                }
            } else {
                if (dy > 0) {
                    changeDirection('down');
                } else {
                    changeDirection('up');
                }
            }
            e.preventDefault();
        });

        startBtn.addEventListener('click', startGame);
        initGame(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    </script>
</body>
</html>